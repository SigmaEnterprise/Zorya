<div id="nostr-feed">
    <header>
        <h3 class="feed-title">Stream of Consciousness by npub16d8gxt2z4k9e8sdpc0yyqzf5gp0np09ls4lnn630qzxzvwpl0rgq5h4rzv</h3>
        <p class="feed-description">Explore the latest thoughts, insights, and media shared in real-time. This feed presents a curated collection of posts from a dynamic, decentralized network with Nostr 'strfry' Relays as the main Database.</p>
    </header>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<script>
// Fix for passive event listeners to avoid browser warnings
document.addEventListener("touchstart", () => {}, { passive: true });
document.addEventListener("wheel", () => {}, { passive: true });

// Fetching Nostr Feed
async function fetchNostrFeed(pubkey, relay) {
    console.log("Connecting to relay:", relay);

    const socket = new WebSocket(relay);

    socket.onopen = () => {
        console.log("WebSocket connected!");

        const filter = {
            kinds: [1, 6, 16, 30023, 66, 13194], // Filter for kinds of posts
            authors: [pubkey],
            limit: 25
        };

        socket.send(JSON.stringify(["REQ", "nostr-feed", filter]));
        console.log("Sent request:", filter);
    };

    socket.onerror = (error) => {
        console.error("WebSocket error:", error);
    };

    socket.onmessage = (event) => {
        try {
            console.log("Received data:", event.data);
            const data = JSON.parse(event.data);
            if (!data || data[0] !== "EVENT") return;

            const eventContent = data[2];
            if (!eventContent || !eventContent.content) return;

            renderPost(eventContent.content);
        } catch (err) {
            console.error("Error parsing WebSocket message:", err);
        }
    };

    socket.onclose = (event) => {
        console.warn("WebSocket closed:", event.reason);
        setTimeout(() => fetchNostrFeed(pubkey, relay), 5000); // Auto-reconnect
    };
}

// Function to render a post
function renderPost(content) {
    const postContainer = document.getElementById("nostr-feed");
    const postElement = document.createElement("div");
    postElement.classList.add("feed-item");

    let contentHTML = marked.parse(content);
    
    // Detect and insert images
    const imageRegex = /(https?:\/\/.*\.(?:png|jpg|jpeg|gif))/g;
    contentHTML = contentHTML.replace(imageRegex, `<img src="$1" alt="Nostr Image">`);

    // Handle video embeds
    const videoRegex = /(https?:\/\/.*\.(?:mp4|ogv))/g;
    contentHTML = contentHTML.replace(videoRegex, `
        <div class="video-container">
            <video controls>
                <source src="$1" type="video/mp4">
                Your browser does not support the video tag.
            </video>
        </div>
    `);

    // Handle YouTube embeds
    const youtubeRegex = /https?:\/\/(?:www\.)?youtube\.com\/watch\?v=([\w-]+)|https?:\/\/youtu\.be\/([\w-]+)/g;
    contentHTML = contentHTML.replace(youtubeRegex, `
        <iframe src="https://www.youtube.com/embed/$1$2" allowfullscreen style="width: 100%; height: 100%; aspect-ratio: 16/9; border: none;"></iframe>
    `);

    // Handle audio files
    const audioRegex = /(https?:\/\/.*\.(?:wav|mp3|ogg))/g;
    contentHTML = contentHTML.replace(audioRegex, `
        <div class="audio-container">
            <audio src="$1"></audio>
            <div class="audio-controls">
                <button class="play-button" onclick="togglePlay(this)">▶ Play</button>
                <input type="range" class="seek-bar" value="0" min="0" step="1" oninput="seekAudio(this)">
                <span class="time-display">0:00 / 0:00</span>
            </div>
        </div>
    `);

    postElement.innerHTML = contentHTML;
    postContainer.appendChild(postElement);
}

// Function to toggle play/pause for audio
function togglePlay(button) {
    const audio = button.closest(".audio-container").querySelector("audio");
    if (audio.paused) {
        audio.play();
        button.textContent = "⏸ Pause";
    } else {
        audio.pause();
        button.textContent = "▶ Play";
    }
}

// Function to seek audio
function seekAudio(input) {
    const audio = input.closest(".audio-container").querySelector("audio");
    audio.currentTime = input.value;
}

// Example usage: fetch feed from a relay
fetchNostrFeed("d34e832d42ad8b93c1a1c3c8400934405f30bcbf857f39ea2f008c26383f78d0", "wss://relay.damus.io");
</script>





<button
    data-npub="npub16d8gxt2z4k9e8sdpc0yyqzf5gp0np09ls4lnn630qzxzvwpl0rgq5h4rzv"
    data-relays="wss://relay.damus.io,wss://relay.snort.social,wss://nostr.wine,wss://relay.nostr.band,wss://nos.lol"
>
    Zap Me ⚡️
</button>

<script src="https://cdn.jsdelivr.net/npm/nostr-zap@0.22.0"></script>

{{ if ne .Site.Params.hideMadeWithLine true }}Made with <a href="https://github.com/janraasch/hugo-bearblog/">Hugo ʕ•ᴥ•ʔ Bear</a>{{ end }}
