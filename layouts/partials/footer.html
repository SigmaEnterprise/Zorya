<div id="nostr-feed">
    <h3>Nostr Feed</h3>
</div>
socket.onmessage = (event) => {
    console.log("Received data:", event.data);
    const data = JSON.parse(event.data);
    if (data[0] !== "EVENT") return;

    const eventContent = data[2];
    const postContainer = document.getElementById("nostr-feed");

    const postElement = document.createElement("div");
    postElement.classList.add("feed-item");

    // Convert markdown to HTML
    let contentHTML = marked.parse(eventContent.content);

    // Detect reposts and display them like normal events
    if (eventContent.kind === 6) {
        // Repost content
        const repostContent = JSON.parse(eventContent.content); // Assuming repost content is stringified JSON

        // Create a special repost section
        const repostDiv = document.createElement('div');
        repostDiv.classList.add('repost');
        
        // Add text or link to the original post
        repostDiv.innerHTML = `Repost of: <a href="${repostContent.e[1]}" target="_blank">${repostContent.e[1]}</a>`;
        
        // Append repost div inside the postElement
        postElement.appendChild(repostDiv);
    }

    // Detect and insert images
    const imageRegex = /(https?:\/\/.*\.(?:png|jpg|jpeg|gif))/g;
    const imageMatches = eventContent.content.match(imageRegex);
    if (imageMatches) {
        imageMatches.forEach(imgUrl => {
            contentHTML += `<img src="${imgUrl}" alt="Nostr Image">`;
        });
    }

    // Handle video embeds (.mp4, .ogv, YouTube)
    const videoRegex = /(https?:\/\/.*\.(?:mp4|ogv))/g;
    const videoMatches = eventContent.content.match(videoRegex);
    if (videoMatches) {
        videoMatches.forEach(videoUrl => {
            contentHTML += 
                `<div class="video-container">
                    <video controls>
                        <source src="${videoUrl}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                </div>`;
        });
    }

    // Handle YouTube video links
    const youtubeVideoRegex = /(https?:\/\/(?:www\.)?youtube\.com\/watch\?v=([\w-]+)|https?:\/\/youtu\.be\/([\w-]+))/g;
    const youtubeVideoMatches = [...eventContent.content.matchAll(youtubeVideoRegex)];
    if (youtubeVideoMatches) {
        youtubeVideoMatches.forEach(match => {
            const videoId = match[2] || match[3];
            contentHTML += `<br><iframe src="https://www.youtube.com/embed/${videoId}" allowfullscreen style="width: 100%; height: 100%; aspect-ratio: 1/1; border: none;"></iframe>`;
        });
    }

    // Handle audio links
    const audioRegex = /(https?:\/\/.*\.(?:wav|mp3|ogg))/g;
    const audioMatches = eventContent.content.match(audioRegex);
    if (audioMatches) {
        audioMatches.forEach(audioUrl => {
            contentHTML += 
                `<div class="audio-container">
                    <audio id="audio-player" src="${audioUrl}"></audio>
                    <div class="audio-controls">
                        <button class="play-button" onclick="togglePlay(this)">▶ Play</button>
                        <input type="range" class="seek-bar" value="0" min="0" step="1" oninput="seekAudio(this)">
                        <span class="time-display">0:00 / 0:00</span>
                    </div>
                </div>`;
        });
    }

    postElement.innerHTML = contentHTML;
    postContainer.appendChild(postElement);

    // Initialize new audio players
    setTimeout(initializeAudioPlayers, 500);
};


<button
    data-npub="npub16d8gxt2z4k9e8sdpc0yyqzf5gp0np09ls4lnn630qzxzvwpl0rgq5h4rzv"
    data-relays="wss://relay.damus.io,wss://relay.snort.social,wss://nostr.wine,wss://relay.nostr.band,wss://nos.lol"
>
    Zap Me ⚡️
</button>

<script src="https://cdn.jsdelivr.net/npm/nostr-zap@0.22.0"></script>

{{ if ne .Site.Params.hideMadeWithLine true }}Made with <a href="https://github.com/janraasch/hugo-bearblog/">Hugo ʕ•ᴥ•ʔ Bear</a>{{ end }}
