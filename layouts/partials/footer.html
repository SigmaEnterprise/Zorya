<div id="nostr-feed">
    <header>
        <h3 class="feed-title">Stream of Consciousness by npub16d8gxt2z4k9e8sdpc0yyqzf5gp0np09ls4lnn630qzxzvwpl0rgq5h4rzv</h3>
        <p class="feed-description">Explore the latest thoughts, insights, and media shared in real-time. This feed presents a curated collection of posts from a dynamic, decentralized network with Nostr 'strfry' Relays as the main Database.</p>
    </header>
<script>
(function loadDependencies() {
    const scripts = [
        "https://cdn.jsdelivr.net/npm/marked/marked.min.js",
        "https://cdn.jsdelivr.net/npm/hls.js@latest",
        "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js" // PDF.js added here
    ];

    scripts.forEach(src => {
        const script = document.createElement("script");
        script.src = src;
        script.async = false; // Ensure scripts load in order
        document.head.appendChild(script);
    });
})();

document.addEventListener("DOMContentLoaded", function () {
    fetchNostrFeed("d34e832d42ad8b93c1a1c3c8400934405f30bcbf857f39ea2f008c26383f78d0", "wss://relay.damus.io");
});

function fetchNostrFeed(pubkey, relay) {
    console.log("Connecting to relay:", relay);
    const socket = new WebSocket(relay);

    socket.onopen = () => {
        console.log("WebSocket connected!");

        const filter = {
            kinds: [1, 30023], // Filter for kinds of posts
            authors: [pubkey],
            limit: 25
        };

        socket.send(JSON.stringify(["REQ", "nostr-feed", filter]));
        console.log("Sent request:", filter);
    };

    socket.onerror = (error) => console.error("WebSocket error:", error);

    socket.onmessage = (event) => {
        console.log("Received data:", event.data);
        const data = JSON.parse(event.data);
        if (data[0] !== "EVENT") return;

        const eventContent = data[2];
        const postContainer = document.getElementById("nostr-feed");

        const postElement = document.createElement("div");
        postElement.classList.add("feed-item");

        // Convert markdown to HTML
        let contentHTML = marked.parse(eventContent.content);
        
        // Handle images
        const imageRegex = /(https?:\/\/.*\.(?:png|jpg|jpeg|gif))/g;
        const imageMatches = eventContent.content.match(imageRegex);
        if (imageMatches) {
            imageMatches.forEach(imgUrl => {
                contentHTML += `<img src="${imgUrl}" alt="Nostr Image">`;
            });
        }

        // Handle video embeds
        const videoRegex = /(https?:\/\/.*\.(?:mp4|ogv))/g;
        const videoMatches = eventContent.content.match(videoRegex);
        if (videoMatches) {
            videoMatches.forEach(videoUrl => {
                contentHTML += `
                    <div class="video-container">
                        <video controls>
                            <source src="${videoUrl}" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    </div>`;
            });
        }

        // Handle IPFS links (for media like mp3, mp4, pdf, images, etc.)
        const ipfsRegex = /(https:\/\/bafybeiehyf2.*\.ipfs\.dweb\.link[\?a-z0-9=&]+)/g;
        const ipfsMatches = eventContent.content.match(ipfsRegex);
        if (ipfsMatches) {
            ipfsMatches.forEach(ipfsUrl => {
                if (ipfsUrl.includes(".mp3") || ipfsUrl.includes(".wav") || ipfsUrl.includes(".ogg")) {
                    // Audio
                    contentHTML += `
                        <div class="audio-container">
                            <audio src="${ipfsUrl}" controls></audio>
                        </div>`;
                } else if (ipfsUrl.includes(".mp4") || ipfsUrl.includes(".ogv")) {
                    // Video
                    contentHTML += `
                        <div class="video-container">
                            <video controls>
                                <source src="${ipfsUrl}" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                        </div>`;
                } else if (ipfsUrl.includes(".pdf")) {
                    // PDF
                    const pdfContainerId = `pdf-viewer-${Date.now()}`;
                    contentHTML += `
                        <div class="pdf-container">
                            <div id="${pdfContainerId}" class="pdf-viewer">
                                <iframe src="${ipfsUrl}" width="100%" height="500px"></iframe>
                            </div>
                        </div>`;
                } else if (ipfsUrl.includes(".png") || ipfsUrl.includes(".jpg") || ipfsUrl.includes(".jpeg") || ipfsUrl.includes(".gif")) {
                    // Image
                    contentHTML += `<img src="${ipfsUrl}" alt="IPFS Image">`;
                }
            });
        }

        postElement.innerHTML = contentHTML;
        postContainer.appendChild(postElement);
    };
}
</script>







<button
    data-npub="npub16d8gxt2z4k9e8sdpc0yyqzf5gp0np09ls4lnn630qzxzvwpl0rgq5h4rzv"
    data-relays="wss://relay.damus.io,wss://relay.snort.social,wss://nostr.wine,wss://relay.nostr.band,wss://nos.lol"
>
    Zap Me ⚡️
</button>

<script src="https://cdn.jsdelivr.net/npm/nostr-zap@0.22.0"></script>

{{ if ne .Site.Params.hideMadeWithLine true }}Made with <a href="https://github.com/janraasch/hugo-bearblog/">Hugo ʕ•ᴥ•ʔ Bear</a>{{ end }}
