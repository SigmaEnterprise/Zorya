<div id="nostr-feed">
    <header>
        <h3 class="feed-title">Stream of Consciousness by npub16d8gxt2z4k9e8sdpc0yyqzf5gp0np09ls4lnn630qzxzvwpl0rgq5h4rzv</h3>
        <p class="feed-description">Explore the latest thoughts, insights, and media shared in real-time. This feed presents a curated collection of posts from a dynamic, decentralized network with Nostr 'strfry' Relays as the main Database.</p>
    </header>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<script>
document.addEventListener("touchstart", () => {}, { passive: true });
document.addEventListener("wheel", () => {}, { passive: true });

function fetchNostrFeed(pubkey, relay) {
    console.log("Connecting to relay:", relay);
    let socket = new WebSocket(relay);

    socket.addEventListener("open", () => {
        console.log("WebSocket connected!");

        const filter = {
            kinds: [1, 6, 16, 30023, 66, 13194],
            authors: [pubkey],
            limit: 25
        };

        socket.send(JSON.stringify(["REQ", "nostr-feed", filter]));
        console.log("Sent request:", filter);
    });

    socket.addEventListener("error", (error) => {
        console.error("WebSocket error:", error);
    });

    socket.addEventListener("message", (event) => {
        try {
            const data = JSON.parse(event.data);
            if (!Array.isArray(data) || data[0] !== "EVENT" || !data[2]?.content) return;
            renderPost(data[2].content);
        } catch (err) {
            console.error("Error parsing WebSocket message:", err);
        }
    });

    socket.addEventListener("close", () => {
        console.warn("WebSocket closed. Reconnecting in 5 seconds...");
        setTimeout(() => fetchNostrFeed(pubkey, relay), 5000);
    });
}

function renderPost(content) {
    const postContainer = document.getElementById("nostr-feed");
    const postElement = document.createElement("div");
    postElement.classList.add("feed-item");

    let contentHTML = marked.parse(content);

    // Image handling
    contentHTML = contentHTML.replace(/(https?:\/\/\S+\.(png|jpe?g|gif))/gi, '<img src="$1" alt="Image">');

    // Video handling
    contentHTML = contentHTML.replace(/(https?:\/\/\S+\.(mp4|ogv))/gi, `
        <video controls>
            <source src="$1" type="video/$2">
            Your browser does not support the video tag.
        </video>
    `);

    // YouTube handling
    contentHTML = contentHTML.replace(/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/watch\?v=|youtu\.be\/)([\w-]+)/gi, `
        <iframe src="https://www.youtube.com/embed/$1" allowfullscreen style="width: 100%; height: 100%; aspect-ratio: 16/9; border: none;"></iframe>
    `);

    // Audio handling
    contentHTML = contentHTML.replace(/(https?:\/\/\S+\.(mp3|wav|ogg))/gi, `
        <div class="audio-container">
            <audio src="$1"></audio>
            <button class="play-button" onclick="togglePlay(this)">▶ Play</button>
        </div>
    `);

    postElement.innerHTML = contentHTML;
    postContainer.appendChild(postElement);
}

function togglePlay(button) {
    const audio = button.previousElementSibling;
    if (!audio) return;

    if (audio.paused) {
        audio.play();
        button.textContent = "⏸ Pause";
    } else {
        audio.pause();
        button.textContent = "▶ Play";
    }
}

fetchNostrFeed("d34e832d42ad8b93c1a1c3c8400934405f30bcbf857f39ea2f008c26383f78d0", "wss://relay.damus.io");
</script>





<button
    data-npub="npub16d8gxt2z4k9e8sdpc0yyqzf5gp0np09ls4lnn630qzxzvwpl0rgq5h4rzv"
    data-relays="wss://relay.damus.io,wss://relay.snort.social,wss://nostr.wine,wss://relay.nostr.band,wss://nos.lol"
>
    Zap Me ⚡️
</button>

<script src="https://cdn.jsdelivr.net/npm/nostr-zap@0.22.0"></script>

{{ if ne .Site.Params.hideMadeWithLine true }}Made with <a href="https://github.com/janraasch/hugo-bearblog/">Hugo ʕ•ᴥ•ʔ Bear</a>{{ end }}
